var THREE=THREE||{REVISION:"49"};if(!self.Int32Array){self.Int32Array=Array;self.Float32Array=Array}(function(){var b=0;var c=["ms","moz","webkit","o"];for(var a=0;a<c.length&&!window.requestAnimationFrame;++a){window.requestAnimationFrame=window[c[a]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[c[a]+"CancelAnimationFrame"]||window[c[a]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(h,e){var d=Date.now(),f=Math.max(0,16-(d-b));var g=window.setTimeout(function(){h(d+f)},f);b=d+f;return g}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(d){clearTimeout(d)}}}());THREE.Clock=function(a){this.autoStart=(a!==undefined)?a:true;this.startTime=0;this.oldTime=0;this.elapsedTime=0;this.running=false};THREE.Clock.prototype.start=function(){this.startTime=Date.now();this.oldTime=this.startTime;this.running=true};THREE.Clock.prototype.stop=function(){this.getElapsedTime();this.running=false};THREE.Clock.prototype.getElapsedTime=function(){this.elapsedTime+=this.getDelta();return this.elapsedTime};THREE.Clock.prototype.getDelta=function(){var b=0;if(this.autoStart&&!this.running){this.start()}if(this.running){var a=Date.now();b=0.001*(a-this.oldTime);this.oldTime=a;this.elapsedTime+=b}return b};THREE.Color=function(a){if(a!==undefined){this.setHex(a)}return this};THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,copy:function(a){this.r=a.r;this.g=a.g;this.b=a.b;return this},copyGammaToLinear:function(a){this.r=a.r*a.r;this.g=a.g*a.g;this.b=a.b*a.b;return this},copyLinearToGamma:function(a){this.r=Math.sqrt(a.r);this.g=Math.sqrt(a.g);this.b=Math.sqrt(a.b);return this},convertGammaToLinear:function(){var d=this.r,c=this.g,a=this.b;this.r=d*d;this.g=c*c;this.b=a*a;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this},setRGB:function(d,c,a){this.r=d;this.g=c;this.b=a;return this},setHSV:function(e,d,a){var c,j,k,g,b;if(a===0){this.r=this.g=this.b=0}else{c=Math.floor(e*6);j=(e*6)-c;k=a*(1-d);g=a*(1-(d*j));b=a*(1-(d*(1-j)));switch(c){case 1:this.r=g;this.g=a;this.b=k;break;case 2:this.r=k;this.g=a;this.b=b;break;case 3:this.r=k;this.g=g;this.b=a;break;case 4:this.r=b;this.g=k;this.b=a;break;case 5:this.r=a;this.g=k;this.b=g;break;case 6:case 0:this.r=a;this.g=b;this.b=k;break}}return this},setHex:function(a){a=Math.floor(a);this.r=(a>>16&255)/255;this.g=(a>>8&255)/255;this.b=(a&255)/255;return this},lerpSelf:function(a,b){this.r+=(a.r-this.r)*b;this.g+=(a.g-this.g)*b;this.b+=(a.b-this.b)*b;return this},getHex:function(){return Math.floor(this.r*255)<<16^Math.floor(this.g*255)<<8^Math.floor(this.b*255)},getContextStyle:function(){return"rgb("+Math.floor(this.r*255)+","+Math.floor(this.g*255)+","+Math.floor(this.b*255)+")"},clone:function(){return new THREE.Color().setRGB(this.r,this.g,this.b)}};THREE.Vector2=function(a,b){this.x=a||0;this.y=b||0};THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(a,b){this.x=a;this.y=b;return this},copy:function(a){this.x=a.x;this.y=a.y;return this},add:function(d,c){this.x=d.x+c.x;this.y=d.y+c.y;return this},addSelf:function(a){this.x+=a.x;this.y+=a.y;return this},sub:function(d,c){this.x=d.x-c.x;this.y=d.y-c.y;return this},subSelf:function(a){this.x-=a.x;this.y-=a.y;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;return this},divideScalar:function(a){if(a){this.x/=a;this.y/=a}else{this.set(0,0)}return this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(c){var b=this.x-c.x,a=this.y-c.y;return b*b+a*a},setLength:function(a){return this.normalize().multiplyScalar(a)},lerpSelf:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;return this},equals:function(a){return((a.x===this.x)&&(a.y===this.y))},isZero:function(){return(this.lengthSq()<0.0001)},clone:function(){return new THREE.Vector2(this.x,this.y)}};THREE.Vector3=function(a,c,b){this.x=a||0;this.y=c||0;this.z=b||0};THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(a,c,b){this.x=a;this.y=c;this.z=b;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},add:function(d,c){this.x=d.x+c.x;this.y=d.y+c.y;this.z=d.z+c.z;return this},addSelf:function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;return this},sub:function(d,c){this.x=d.x-c.x;this.y=d.y-c.y;this.z=d.z-c.z;return this},subSelf:function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;return this},multiply:function(d,c){this.x=d.x*c.x;this.y=d.y*c.y;this.z=d.z*c.z;return this},multiplySelf:function(a){this.x*=a.x;this.y*=a.y;this.z*=a.z;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=a;return this},divideSelf:function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this},divideScalar:function(a){if(a){this.x/=a;this.y/=a;this.z/=a}else{this.x=0;this.y=0;this.z=0}return this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.lengthSq())},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.normalize().multiplyScalar(a)},lerpSelf:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;return this},cross:function(d,c){this.x=d.y*c.z-d.z*c.y;this.y=d.z*c.x-d.x*c.z;this.z=d.x*c.y-d.y*c.x;return this},crossSelf:function(b){var a=this.x,d=this.y,c=this.z;this.x=d*b.z-c*b.y;this.y=c*b.x-a*b.z;this.z=a*b.y-d*b.x;return this},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){return new THREE.Vector3().sub(this,a).lengthSq()},getPositionFromMatrix:function(a){this.x=a.elements[12];this.y=a.elements[13];this.z=a.elements[14];return this},getRotationFromMatrix:function(d,e){var n=e?e.x:1;var l=e?e.y:1;var j=e?e.z:1;var i=d.elements[0]/n,h=d.elements[4]/l,g=d.elements[8]/j;var c=d.elements[1]/n,b=d.elements[5]/l,a=d.elements[9]/j;var k=d.elements[10]/j;this.y=Math.asin(g);var f=Math.cos(this.y);if(Math.abs(f)>0.00001){this.x=Math.atan2(-a/f,k/f);this.z=Math.atan2(-h/f,i/f)}else{this.x=0;this.z=Math.atan2(c,b)}return this},getScaleFromMatrix:function(a){var d=this.set(a.elements[0],a.elements[1],a.elements[2]).length();var c=this.set(a.elements[4],a.elements[5],a.elements[6]).length();var b=this.set(a.elements[8],a.elements[9],a.elements[10]).length();this.x=d;this.y=c;this.z=b},equals:function(a){return((a.x===this.x)&&(a.y===this.y)&&(a.z===this.z))},isZero:function(){return(this.lengthSq()<0.0001)},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}};THREE.Vector4=function(a,d,c,b){this.x=a||0;this.y=d||0;this.z=c||0;this.w=(b!==undefined)?b:1};THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(a,d,c,b){this.x=a;this.y=d;this.z=c;this.w=b;return this},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=(a.w!==undefined)?a.w:1;return this},add:function(d,c){this.x=d.x+c.x;this.y=d.y+c.y;this.z=d.z+c.z;this.w=d.w+c.w;return this},addSelf:function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this},sub:function(d,c){this.x=d.x-c.x;this.y=d.y-c.y;this.z=d.z-c.z;this.w=d.w-c.w;return this},subSelf:function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=a;this.w*=a;return this},divideScalar:function(a){if(a){this.x/=a;this.y/=a;this.z/=a;this.w/=a}else{this.x=0;this.y=0;this.z=0;this.w=1}return this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},lengthSq:function(){return this.dot(this)},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.normalize().multiplyScalar(a)},lerpSelf:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;this.w+=(a.w-this.w)*b;return this},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}};THREE.Frustum=function(){this.planes=[new THREE.Vector4(),new THREE.Vector4(),new THREE.Vector4(),new THREE.Vector4(),new THREE.Vector4(),new THREE.Vector4()]};THREE.Frustum.prototype.setFromMatrix=function(q){var u,a,j=this.planes;var w=q.elements;var o=w[0],l=w[1],k=w[2],h=w[3];var g=w[4],f=w[5],e=w[6],d=w[7];var c=w[8],b=w[9],v=w[10],t=w[11];var s=w[12],r=w[13],p=w[14],n=w[15];j[0].set(h-o,d-g,t-c,n-s);j[1].set(h+o,d+g,t+c,n+s);j[2].set(h+l,d+f,t+b,n+r);j[3].set(h-l,d-f,t-b,n-r);j[4].set(h-k,d-e,t-v,n-p);j[5].set(h+k,d+e,t+v,n+p);for(u=0;u<6;u++){a=j[u];a.divideScalar(Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z))}};THREE.Frustum.prototype.contains=function(d){var g,c=this.planes,b=d.matrixWorld,f=b.elements,a=-d.geometry.boundingSphere.radius*b.getMaxScaleOnAxis();for(var e=0;e<6;e++){g=c[e].x*f[12]+c[e].y*f[13]+c[e].z*f[14]+c[e].w;if(g<=a){return false}}return true};THREE.Frustum.__v1=new THREE.Vector3();THREE.Ray=function(G,D){this.origin=G||new THREE.Vector3();this.direction=D||new THREE.Vector3();var z=0.0001;this.setPrecision=function(a){z=a};var F=new THREE.Vector3();var E=new THREE.Vector3();var C=new THREE.Vector3();var B=new THREE.Vector3();var m=new THREE.Vector3();var l=new THREE.Vector3();var h=new THREE.Vector3();var H=new THREE.Vector3();var y=new THREE.Vector3();this.intersectObject=function(v){var d,J=[];if(v instanceof THREE.Particle){var b=q(this.origin,this.direction,v.matrixWorld.getPosition());if(b>v.scale.x){return[]}d={distance:b,point:v.position,face:null,object:v};J.push(d)}else{if(v instanceof THREE.Mesh){var b=q(this.origin,this.direction,v.matrixWorld.getPosition());var u=THREE.Frustum.__v1.set(v.matrixWorld.getColumnX().length(),v.matrixWorld.getColumnY().length(),v.matrixWorld.getColumnZ().length());if(b>v.geometry.boundingSphere.radius*Math.max(u.x,Math.max(u.y,u.z))){return J}var I,O,L,a,c,N=v.geometry,K=N.vertices,M;v.matrixRotationWorld.extractRotation(v.matrixWorld);for(I=0,O=N.faces.length;I<O;I++){L=N.faces[I];m.copy(this.origin);l.copy(this.direction);M=v.matrixWorld;h=M.multiplyVector3(h.copy(L.centroid)).subSelf(m);H=v.matrixRotationWorld.multiplyVector3(H.copy(L.normal));a=l.dot(H);if(Math.abs(a)<z){continue}c=H.dot(h)/a;if(c<0){continue}if(v.doubleSided||(v.flipSided?a>0:a<0)){y.add(m,l.multiplyScalar(c));if(L instanceof THREE.Face3){F=M.multiplyVector3(F.copy(K[L.a]));E=M.multiplyVector3(E.copy(K[L.b]));C=M.multiplyVector3(C.copy(K[L.c]));if(x(y,F,E,C)){d={distance:m.distanceTo(y),point:y.clone(),face:L,object:v};J.push(d)}}else{if(L instanceof THREE.Face4){F=M.multiplyVector3(F.copy(K[L.a]));E=M.multiplyVector3(E.copy(K[L.b]));C=M.multiplyVector3(C.copy(K[L.c]));B=M.multiplyVector3(B.copy(K[L.d]));if(x(y,F,E,B)||x(y,E,C,B)){d={distance:m.distanceTo(y),point:y.clone(),face:L,object:v};J.push(d)}}}}}}}return J};this.intersectObjects=function(d){var c=[];for(var b=0,a=d.length;b<a;b++){Array.prototype.push.apply(c,this.intersectObject(d[b]))}c.sort(function(v,u){return v.distance-u.distance});return c};var k=new THREE.Vector3(),i=new THREE.Vector3(),g=new THREE.Vector3();var r,A,n;function q(b,c,a){k.sub(a,b);r=k.dot(c);A=i.add(b,g.copy(c).multiplyScalar(r));n=a.distanceTo(A);return n}var w,t,s,f,e,j,p,o;function x(v,u,d,I){k.sub(I,u);i.sub(d,u);g.sub(v,u);w=k.dot(k);t=k.dot(i);s=k.dot(g);f=i.dot(i);e=i.dot(g);j=1/(w*f-t*t);p=(f*s-t*e)*j;o=(w*e-t*s)*j;return(p>=0)&&(o>=0)&&(p+o<1)}};THREE.Rectangle=function(){var e,g,h,d,a,c,f=true;function b(){a=h-e;c=d-g}this.getX=function(){return e};this.getY=function(){return g};this.getWidth=function(){return a};this.getHeight=function(){return c};this.getLeft=function(){return e};this.getTop=function(){return g};this.getRight=function(){return h};this.getBottom=function(){return d};this.set=function(l,k,j,i){f=false;e=l;g=k;h=j;d=i;b()};this.addPoint=function(i,j){if(f){f=false;e=i;g=j;h=i;d=j;b()}else{e=e<i?e:i;g=g<j?g:j;h=h>i?h:i;d=d>j?d:j;b()}};this.add3Points=function(l,n,j,m,i,k){if(f){f=false;e=l<j?(l<i?l:i):(j<i?j:i);g=n<m?(n<k?n:k):(m<k?m:k);h=l>j?(l>i?l:i):(j>i?j:i);d=n>m?(n>k?n:k):(m>k?m:k);b()}else{e=l<j?(l<i?(l<e?l:e):(i<e?i:e)):(j<i?(j<e?j:e):(i<e?i:e));g=n<m?(n<k?(n<g?n:g):(k<g?k:g)):(m<k?(m<g?m:g):(k<g?k:g));h=l>j?(l>i?(l>h?l:h):(i>h?i:h)):(j>i?(j>h?j:h):(i>h?i:h));d=n>m?(n>k?(n>d?n:d):(k>d?k:d)):(m>k?(m>d?m:d):(k>d?k:d));b()}};this.addRectangle=function(i){if(f){f=false;e=i.getLeft();g=i.getTop();h=i.getRight();d=i.getBottom();b()}else{e=e<i.getLeft()?e:i.getLeft();g=g<i.getTop()?g:i.getTop();h=h>i.getRight()?h:i.getRight();d=d>i.getBottom()?d:i.getBottom();b()}};this.inflate=function(i){e-=i;g-=i;h+=i;d+=i;b()};this.minSelf=function(i){e=e>i.getLeft()?e:i.getLeft();g=g>i.getTop()?g:i.getTop();h=h<i.getRight()?h:i.getRight();d=d<i.getBottom()?d:i.getBottom();b()};this.intersects=function(i){if(h<i.getLeft()){return false}if(e>i.getRight()){return false}if(d<i.getTop()){return false}if(g>i.getBottom()){return false}return true};this.empty=function(){f=true;e=0;g=0;h=0;d=0;b()};this.isEmpty=function(){return f}};THREE.Math={clamp:function(d,e,c){return(d<e)?e:((d>c)?c:d)},clampBottom:function(b,c){return b<c?c:b},mapLinear:function(b,c,a,e,d){return e+(b-c)*(d-e)/(a-c)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(a,b){return a+Math.floor(Math.random()*(b-a+1))},randFloat:function(a,b){return a+Math.random()*(b-a)},randFloatSpread:function(a){return a*(0.5-Math.random())},sign:function(a){return(a<0)?-1:((a>0)?1:0)}};THREE.Matrix3=function(){this.elements=new Float32Array(9)};THREE.Matrix3.prototype={constructor:THREE.Matrix3,getInverse:function(k){var j=k.elements;var o=j[10]*j[5]-j[6]*j[9];var i=-j[10]*j[1]+j[2]*j[9];var d=j[6]*j[1]-j[2]*j[5];var n=-j[10]*j[4]+j[6]*j[8];var g=j[10]*j[0]-j[2]*j[8];var c=-j[6]*j[0]+j[2]*j[4];var l=j[9]*j[4]-j[5]*j[8];var f=-j[9]*j[0]+j[1]*j[8];var a=j[5]*j[0]-j[1]*j[4];var h=j[0]*o+j[1]*n+j[2]*l;if(h===0){console.warn("Matrix3.getInverse(): determinant == 0")}var b=1/h;var e=this.elements;e[0]=b*o;e[1]=b*i;e[2]=b*d;e[3]=b*n;e[4]=b*g;e[5]=b*c;e[6]=b*l;e[7]=b*f;e[8]=b*a;return this},transpose:function(){var b,a=this.elements;b=a[1];a[1]=a[3];a[3]=b;b=a[2];a[2]=a[6];a[6]=b;b=a[5];a[5]=a[7];a[7]=b;return this},transposeIntoArray:function(b){var a=this.m;b[0]=a[0];b[1]=a[3];b[2]=a[6];b[3]=a[1];b[4]=a[4];b[5]=a[7];b[6]=a[2];b[7]=a[5];b[8]=a[8];return this}};THREE.Matrix4=function(m,l,j,h,e,d,c,b,a,p,o,n,k,i,g,f){this.elements=new Float32Array(16);this.set((m!==undefined)?m:1,l||0,j||0,h||0,e||0,(d!==undefined)?d:1,c||0,b||0,a||0,p||0,(o!==undefined)?o:1,n||0,k||0,i||0,g||0,(f!==undefined)?f:1)};THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(n,m,k,i,f,e,d,c,a,q,p,o,l,j,h,g){var b=this.elements;b[0]=n;b[4]=m;b[8]=k;b[12]=i;b[1]=f;b[5]=e;b[9]=d;b[13]=c;b[2]=a;b[6]=q;b[10]=p;b[14]=o;b[3]=l;b[7]=j;b[11]=h;b[15]=g;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(a){var b=a.elements;this.set(b[0],b[4],b[8],b[12],b[1],b[5],b[9],b[13],b[2],b[6],b[10],b[14],b[3],b[7],b[11],b[15]);return this},lookAt:function(c,d,b){var f=this.elements;var a=THREE.Matrix4.__v1;var g=THREE.Matrix4.__v2;var e=THREE.Matrix4.__v3;e.sub(c,d).normalize();if(e.length()===0){e.z=1}a.cross(b,e).normalize();if(a.length()===0){e.x+=0.0001;a.cross(b,e).normalize()}g.cross(e,a);f[0]=a.x;f[4]=g.x;f[8]=e.x;f[1]=a.y;f[5]=g.y;f[9]=e.y;f[2]=a.z;f[6]=g.z;f[10]=e.z;return this},multiply:function(M,L){var s=M.elements;var K=L.elements;var c=this.elements;var p=s[0],n=s[4],m=s[8],l=s[12];var J=s[1],I=s[5],H=s[9],G=s[13];var B=s[2],A=s[6],z=s[10],y=s[14];var t=s[3],r=s[7],q=s[11],o=s[15];var i=K[0],g=K[4],e=K[8],d=K[12];var F=K[1],E=K[5],D=K[9],C=K[13];var x=K[2],w=K[6],v=K[10],u=K[14];var k=K[3],j=K[7],h=K[11],f=K[15];c[0]=p*i+n*F+m*x+l*k;c[4]=p*g+n*E+m*w+l*j;c[8]=p*e+n*D+m*v+l*h;c[12]=p*d+n*C+m*u+l*f;c[1]=J*i+I*F+H*x+G*k;c[5]=J*g+I*E+H*w+G*j;c[9]=J*e+I*D+H*v+G*h;c[13]=J*d+I*C+H*u+G*f;c[2]=B*i+A*F+z*x+y*k;c[6]=B*g+A*E+z*w+y*j;c[10]=B*e+A*D+z*v+y*h;c[14]=B*d+A*C+z*u+y*f;c[3]=t*i+r*F+q*x+o*k;c[7]=t*g+r*E+q*w+o*j;c[11]=t*e+r*D+q*v+o*h;c[15]=t*d+r*C+q*u+o*f;return this},multiplySelf:function(a){return this.multiply(this,a)},multiplyToArray:function(d,c,e){var f=this.elements;this.multiply(d,c);e[0]=f[0];e[1]=f[1];e[2]=f[2];e[3]=f[3];e[4]=f[4];e[5]=f[5];e[6]=f[6];e[7]=f[7];e[8]=f[8];e[9]=f[9];e[10]=f[10];e[11]=f[11];e[12]=f[12];e[13]=f[13];e[14]=f[14];e[15]=f[15];return this},multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[4]*=a;b[8]*=a;b[12]*=a;b[1]*=a;b[5]*=a;b[9]*=a;b[13]*=a;b[2]*=a;b[6]*=a;b[10]*=a;b[14]*=a;b[3]*=a;b[7]*=a;b[11]*=a;b[15]*=a;return this},multiplyVector3:function(a){var g=this.elements;var e=a.x,c=a.y,b=a.z;var f=1/(g[3]*e+g[7]*c+g[11]*b+g[15]);a.x=(g[0]*e+g[4]*c+g[8]*b+g[12])*f;a.y=(g[1]*e+g[5]*c+g[9]*b+g[13])*f;a.z=(g[2]*e+g[6]*c+g[10]*b+g[14])*f;return a},multiplyVector4:function(a){var f=this.elements;var d=a.x,c=a.y,b=a.z,e=a.w;a.x=f[0]*d+f[4]*c+f[8]*b+f[12]*e;a.y=f[1]*d+f[5]*c+f[9]*b+f[13]*e;a.z=f[2]*d+f[6]*c+f[10]*b+f[14]*e;a.w=f[3]*d+f[7]*c+f[11]*b+f[15]*e;return a},rotateAxis:function(a){var e=this.elements;var d=a.x,c=a.y,b=a.z;a.x=d*e[0]+c*e[4]+b*e[8];a.y=d*e[1]+c*e[5]+b*e[9];a.z=d*e[2]+c*e[6]+b*e[10];a.normalize();return a},crossVector:function(b){var d=this.elements;var c=new THREE.Vector4();c.x=d[0]*b.x+d[4]*b.y+d[8]*b.z+d[12]*b.w;c.y=d[1]*b.x+d[5]*b.y+d[9]*b.z+d[13]*b.w;c.z=d[2]*b.x+d[6]*b.y+d[10]*b.z+d[14]*b.w;c.w=(b.w)?d[3]*b.x+d[7]*b.y+d[11]*b.z+d[15]*b.w:1;return c},determinant:function(){var c=this.elements;var n=c[0],m=c[4],k=c[8],i=c[12];var f=c[1],e=c[5],d=c[9],b=c[13];var a=c[2],q=c[6],p=c[10],o=c[14];var l=c[3],j=c[7],h=c[11],g=c[15];return(i*d*q*l-k*b*q*l-i*e*p*l+m*b*p*l+k*e*o*l-m*d*o*l-i*d*a*j+k*b*a*j+i*f*p*j-n*b*p*j-k*f*o*j+n*d*o*j+i*e*a*h-m*b*a*h-i*f*q*h+n*b*q*h+m*f*o*h-n*e*o*h-k*e*a*g+m*d*a*g+k*f*q*g-n*d*q*g-m*f*p*g+n*e*p*g)},transpose:function(){var b=this.elements;var a;a=b[1];b[1]=b[4];b[4]=a;a=b[2];b[2]=b[8];b[8]=a;a=b[6];b[6]=b[9];b[9]=a;a=b[3];b[3]=b[12];b[12]=a;a=b[7];b[7]=b[13];b[13]=a;a=b[11];b[11]=b[14];b[14]=a;return this},flattenToArray:function(b){var a=this.elements;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b},flattenToArrayOffset:function(c,b){var a=this.elements;c[b]=a[0];c[b+1]=a[1];c[b+2]=a[2];c[b+3]=a[3];c[b+4]=a[4];c[b+5]=a[5];c[b+6]=a[6];c[b+7]=a[7];c[b+8]=a[8];c[b+9]=a[9];c[b+10]=a[10];c[b+11]=a[11];c[b+12]=a[12];c[b+13]=a[13];c[b+14]=a[14];c[b+15]=a[15];return c},getPosition:function(){var a=this.elements;return THREE.Matrix4.__v1.set(a[12],a[13],a[14])},setPosition:function(a){var b=this.elements;b[12]=a.x;b[13]=a.y;b[14]=a.z;return this},getColumnX:function(){var a=this.elements;return THREE.Matrix4.__v1.set(a[0],a[1],a[2])},getColumnY:function(){var a=this.elements;return THREE.Matrix4.__v1.set(a[4],a[5],a[6])},getColumnZ:function(){var a=this.elements;return THREE.Matrix4.__v1.set(a[8],a[9],a[10])},getInverse:function(o){var e=this.elements;var t=o.elements;var k=t[0],j=t[4],h=t[8],f=t[12];var s=t[1],r=t[5],q=t[9],p=t[13];var d=t[2],c=t[6],b=t[10],a=t[14];var n=t[3],l=t[7],i=t[11],g=t[15];e[0]=q*a*l-p*b*l+p*c*i-r*a*i-q*c*g+r*b*g;e[4]=f*b*l-h*a*l-f*c*i+j*a*i+h*c*g-j*b*g;e[8]=h*p*l-f*q*l+f*r*i-j*p*i-h*r*g+j*q*g;e[12]=f*q*c-h*p*c-f*r*b+j*p*b+h*r*a-j*q*a;e[1]=p*b*n-q*a*n-p*d*i+s*a*i+q*d*g-s*b*g;e[5]=h*a*n-f*b*n+f*d*i-k*a*i-h*d*g+k*b*g;e[9]=f*q*n-h*p*n-f*s*i+k*p*i+h*s*g-k*q*g;e[13]=h*p*d-f*q*d+f*s*b-k*p*b-h*s*a+k*q*a;e[2]=r*a*n-p*c*n+p*d*l-s*a*l-r*d*g+s*c*g;e[6]=f*c*n-j*a*n-f*d*l+k*a*l+j*d*g-k*c*g;e[10]=j*p*n-f*r*n+f*s*l-k*p*l-j*s*g+k*r*g;e[14]=f*r*d-j*p*d-f*s*c+k*p*c+j*s*a-k*r*a;e[3]=q*c*n-r*b*n-q*d*l+s*b*l+r*d*i-s*c*i;e[7]=j*b*n-h*c*n+h*d*l-k*b*l-j*d*i+k*c*i;e[11]=h*r*n-j*q*n-h*s*l+k*q*l+j*s*i-k*r*i;e[15]=j*q*d-h*r*d+h*s*c-k*q*c-j*s*b+k*r*b;this.multiplyScalar(1/o.determinant());return this},setRotationFromEuler:function(o,r){var k=this.elements;var n=o.x,m=o.y,l=o.z;var H=Math.cos(n),G=Math.sin(n);var E=Math.cos(m),B=Math.sin(m);var u=Math.cos(l),s=Math.sin(l);switch(r){case"YXZ":var q=E*u,p=E*s,D=B*u,A=B*s;k[0]=q+A*G;k[4]=D*G-p;k[8]=H*B;k[1]=H*s;k[5]=H*u;k[9]=-G;k[2]=p*G-D;k[6]=A+q*G;k[10]=H*E;break;case"ZXY":var q=E*u,p=E*s,D=B*u,A=B*s;k[0]=q-A*G;k[4]=-H*s;k[8]=D+p*G;k[1]=p+D*G;k[5]=H*u;k[9]=A-q*G;k[2]=-H*B;k[6]=G;k[10]=H*E;break;case"ZYX":var w=H*u,t=H*s,h=G*u,g=G*s;k[0]=E*u;k[4]=h*B-t;k[8]=w*B+g;k[1]=E*s;k[5]=g*B+w;k[9]=t*B-h;k[2]=-B;k[6]=G*E;k[10]=H*E;break;case"YZX":var F=H*E,C=H*B,j=G*E,i=G*B;k[0]=E*u;k[4]=i-F*s;k[8]=j*s+C;k[1]=s;k[5]=H*u;k[9]=-G*u;k[2]=-B*u;k[6]=C*s+j;k[10]=F-i*s;break;case"XZY":var F=H*E,C=H*B,j=G*E,i=G*B;k[0]=E*u;k[4]=-s;k[8]=B*u;k[1]=F*s+i;k[5]=H*u;k[9]=C*s-j;k[2]=j*s-C;k[6]=G*u;k[10]=i*s+F;break;default:var w=H*u,t=H*s,h=G*u,g=G*s;k[0]=E*u;k[4]=-E*s;k[8]=B;k[1]=t+h*B;k[5]=w-g*B;k[9]=-G*E;k[2]=g-w*B;k[6]=h+t*B;k[10]=H*E;break}return this},setRotationFromQuaternion:function(l){var e=this.elements;var h=l.x,g=l.y,f=l.z,i=l.w;var n=h+h,a=g+g,j=f+f;var d=h*n,c=h*a,b=h*j;var m=g*a,k=g*j,r=f*j;var s=i*n,p=i*a,o=i*j;e[0]=1-(m+r);e[4]=c-o;e[8]=b+p;e[1]=c+o;e[5]=1-(d+r);e[9]=k-s;e[2]=b-p;e[6]=k+s;e[10]=1-(d+m);return this},compose:function(f,a,e){var d=this.elements;var c=THREE.Matrix4.__m1;var b=THREE.Matrix4.__m2;c.identity();c.setRotationFromQuaternion(a);b.makeScale(e.x,e.y,e.z);this.multiply(c,b);d[12]=f.x;d[13]=f.y;d[14]=f.z;return this},decompose:function(h,c,f){var e=this.elements;var a=THREE.Matrix4.__v1;var g=THREE.Matrix4.__v2;var d=THREE.Matrix4.__v3;a.set(e[0],e[1],e[2]);g.set(e[4],e[5],e[6]);d.set(e[8],e[9],e[10]);h=(h instanceof THREE.Vector3)?h:new THREE.Vector3();c=(c instanceof THREE.Quaternion)?c:new THREE.Quaternion();f=(f instanceof THREE.Vector3)?f:new THREE.Vector3();f.x=a.length();f.y=g.length();f.z=d.length();h.x=e[12];h.y=e[13];h.z=e[14];var b=THREE.Matrix4.__m1;b.copy(this);b.elements[0]/=f.x;b.elements[1]/=f.x;b.elements[2]/=f.x;b.elements[4]/=f.y;b.elements[5]/=f.y;b.elements[6]/=f.y;b.elements[8]/=f.z;b.elements[9]/=f.z;b.elements[10]/=f.z;c.setFromRotationMatrix(b);return[h,c,f]},extractPosition:function(a){var c=this.elements;var b=a.elements;c[12]=b[12];c[13]=b[13];c[14]=b[14];return this},extractRotation:function(a){var g=this.elements;var f=a.elements;var c=THREE.Matrix4.__v1;var e=1/c.set(f[0],f[1],f[2]).length();var d=1/c.set(f[4],f[5],f[6]).length();var b=1/c.set(f[8],f[9],f[10]).length();g[0]=f[0]*e;g[1]=f[1]*e;g[2]=f[2]*e;g[4]=f[4]*d;g[5]=f[5]*d;g[6]=f[6]*d;g[8]=f[8]*b;g[9]=f[9]*b;g[10]=f[10]*b;return this},translate:function(b){var d=this.elements;var a=b.x,e=b.y,c=b.z;d[12]=d[0]*a+d[4]*e+d[8]*c+d[12];d[13]=d[1]*a+d[5]*e+d[9]*c+d[13];d[14]=d[2]*a+d[6]*e+d[10]*c+d[14];d[15]=d[3]*a+d[7]*e+d[11]*c+d[15];return this},rotateX:function(e){var d=this.elements;var i=d[4];var b=d[5];var l=d[6];var h=d[7];var g=d[8];var a=d[9];var k=d[10];var f=d[11];var j=Math.cos(e);var m=Math.sin(e);d[4]=j*i+m*g;d[5]=j*b+m*a;d[6]=j*l+m*k;d[7]=j*h+m*f;d[8]=j*g-m*i;d[9]=j*a-m*b;d[10]=j*k-m*l;d[11]=j*f-m*h;return this},rotateY:function(e){var d=this.elements;var i=d[0];var b=d[1];var l=d[2];var h=d[3];var g=d[8];var a=d[9];var k=d[10];var f=d[11];var j=Math.cos(e);var m=Math.sin(e);d[0]=j*i-m*g;d[1]=j*b-m*a;d[2]=j*l-m*k;d[3]=j*h-m*f;d[8]=j*g+m*i;d[9]=j*a+m*b;d[10]=j*k+m*l;d[11]=j*f+m*h;return this},rotateZ:function(e){var d=this.elements;var i=d[0];var b=d[1];var l=d[2];var h=d[3];var g=d[4];var a=d[5];var k=d[6];var f=d[7];var j=Math.cos(e);var m=Math.sin(e);d[0]=j*i+m*g;d[1]=j*b+m*a;d[2]=j*l+m*k;d[3]=j*h+m*f;d[4]=j*g-m*i;d[5]=j*a-m*b;d[6]=j*k-m*l;d[7]=j*f-m*h;return this},rotateByAxis:function(o,m){var a=this.elements;if(o.x===1&&o.y===0&&o.z===0){return this.rotateX(m)}else{if(o.x===0&&o.y===1&&o.z===0){return this.rotateY(m)}else{if(o.x===0&&o.y===0&&o.z===1){return this.rotateZ(m)}}}var H=o.x,G=o.y,F=o.z;var K=Math.sqrt(H*H+G*G+F*F);H/=K;G/=K;F/=K;var A=H*H,h=G*G,S=F*F;var U=Math.cos(m);var I=Math.sin(m);var p=1-U;var w=H*G*p;var v=H*F*p;var g=G*F*p;var C=H*I;var l=G*I;var X=F*I;var k=A+(1-A)*U;var W=w+X;var E=v-l;var j=w-X;var V=h+(1-h)*U;var D=g+C;var i=v+l;var T=g-C;var B=S+(1-S)*U;var P=a[0],u=a[1],f=a[2],R=a[3];var N=a[4],t=a[5],e=a[6],Q=a[7];var L=a[8],r=a[9],d=a[10],O=a[11];var J=a[12],q=a[13],b=a[14],M=a[15];a[0]=k*P+W*N+E*L;a[1]=k*u+W*t+E*r;a[2]=k*f+W*e+E*d;a[3]=k*R+W*Q+E*O;a[4]=j*P+V*N+D*L;a[5]=j*u+V*t+D*r;a[6]=j*f+V*e+D*d;a[7]=j*R+V*Q+D*O;a[8]=i*P+T*N+B*L;a[9]=i*u+T*t+B*r;a[10]=i*f+T*e+B*d;a[11]=i*R+T*Q+B*O;return this},scale:function(b){var d=this.elements;var a=b.x,e=b.y,c=b.z;d[0]*=a;d[4]*=e;d[8]*=c;d[1]*=a;d[5]*=e;d[9]*=c;d[2]*=a;d[6]*=e;d[10]*=c;d[3]*=a;d[7]*=e;d[11]*=c;return this},getMaxScaleOnAxis:function(){var c=this.elements;var d=c[0]*c[0]+c[1]*c[1]+c[2]*c[2];var b=c[4]*c[4]+c[5]*c[5]+c[6]*c[6];var a=c[8]*c[8]+c[9]*c[9]+c[10]*c[10];return Math.sqrt(Math.max(d,Math.max(b,a)))},makeTranslation:function(a,c,b){this.set(1,0,0,a,0,1,0,c,0,0,1,b,0,0,0,1);return this},makeRotationX:function(a){var d=Math.cos(a),b=Math.sin(a);this.set(1,0,0,0,0,d,-b,0,0,b,d,0,0,0,0,1);return this},makeRotationY:function(a){var d=Math.cos(a),b=Math.sin(a);this.set(d,0,b,0,0,1,0,0,-b,0,d,0,0,0,0,1);return this},makeRotationZ:function(a){var d=Math.cos(a),b=Math.sin(a);this.set(d,-b,0,0,b,d,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(a,b){var f=Math.cos(b);var k=Math.sin(b);var j=1-f;var i=a.x,h=a.y,g=a.z;var e=j*i,d=j*h;this.set(e*i+f,e*h-k*g,e*g+k*h,0,e*h+k*g,d*h+f,d*g-k*i,0,e*g-k*h,d*g+k*i,j*g*g+f,0,0,0,0,1);return this},makeScale:function(a,c,b){this.set(a,0,0,0,0,c,0,0,0,0,b,0,0,0,0,1);return this},makeFrustum:function(g,q,e,n,i,h){var f=this.elements;var p=2*i/(q-g);var m=2*i/(n-e);var o=(q+g)/(q-g);var l=(n+e)/(n-e);var k=-(h+i)/(h-i);var j=-2*h*i/(h-i);f[0]=p;f[4]=0;f[8]=o;f[12]=0;f[1]=0;f[5]=m;f[9]=l;f[13]=0;f[2]=0;f[6]=0;f[10]=k;f[14]=j;f[3]=0;f[7]=0;f[11]=-1;f[15]=0;return this},makePerspective:function(e,c,g,b){var a=g*Math.tan(e*Math.PI/360);var f=-a;var h=f*c;var d=a*c;return this.makeFrustum(h,d,f,a,g,b)},makeOrthographic:function(d,n,k,a,g,f){var c=this.elements;var m=n-d;var e=k-a;var b=f-g;var l=(n+d)/m;var j=(k+a)/e;var i=(f+g)/b;c[0]=2/m;c[4]=0;c[8]=0;c[12]=-l;c[1]=0;c[5]=2/e;c[9]=0;c[13]=-j;c[2]=0;c[6]=0;c[10]=-2/b;c[14]=-i;c[3]=0;c[7]=0;c[11]=0;c[15]=1;return this},clone:function(){var a=this.elements;return new THREE.Matrix4(a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15])}};THREE.Matrix4.__v1=new THREE.Vector3();THREE.Matrix4.__v2=new THREE.Vector3();THREE.Matrix4.__v3=new THREE.Vector3();THREE.Matrix4.__m1=new THREE.Matrix4();THREE.Matrix4.__m2=new THREE.Matrix4();THREE.Object3D=function(){this.id=THREE.Object3DCount++;this.name="";this.parent=undefined;this.children=[];this.up=new THREE.Vector3(0,1,0);this.position=new THREE.Vector3();this.rotation=new THREE.Vector3();this.eulerOrder="XYZ";this.scale=new THREE.Vector3(1,1,1);this.doubleSided=false;this.flipSided=false;this.renderDepth=null;this.rotationAutoUpdate=true;this.matrix=new THREE.Matrix4();this.matrixWorld=new THREE.Matrix4();this.matrixRotationWorld=new THREE.Matrix4();this.matrixAutoUpdate=true;this.matrixWorldNeedsUpdate=true;this.quaternion=new THREE.Quaternion();this.useQuaternion=false;this.boundRadius=0;this.boundRadiusScale=1;this.visible=true;this.castShadow=false;this.receiveShadow=false;this.frustumCulled=true;this._vector=new THREE.Vector3()};THREE.Object3D.prototype={constructor:THREE.Object3D,applyMatrix:function(a){this.matrix.multiply(a,this.matrix);this.scale.getScaleFromMatrix(this.matrix);this.rotation.getRotationFromMatrix(this.matrix,this.scale);this.position.getPositionFromMatrix(this.matrix)},translate:function(b,a){this.matrix.rotateAxis(a);this.position.addSelf(a.multiplyScalar(b))},translateX:function(a){this.translate(a,this._vector.set(1,0,0))},translateY:function(a){this.translate(a,this._vector.set(0,1,0))},translateZ:function(a){this.translate(a,this._vector.set(0,0,1))},lookAt:function(a){this.matrix.lookAt(a,this.position,this.up);if(this.rotationAutoUpdate){this.rotation.getRotationFromMatrix(this.matrix)}},add:function(a){if(a===this){console.warn("THREE.Object3D.add: An object can't be added as a child of itself.");return}if(a instanceof THREE.Object3D){if(a.parent!==undefined){a.parent.remove(a)}a.parent=this;this.children.push(a);var b=this;while(b.parent!==undefined){b=b.parent}if(b!==undefined&&b instanceof THREE.Scene){b.__addObject(a)}}},remove:function(b){var a=this.children.indexOf(b);if(a!==-1){b.parent=undefined;this.children.splice(a,1);var c=this;while(c.parent!==undefined){c=c.parent}if(c!==undefined&&c instanceof THREE.Scene){c.__removeObject(b)}}},getChildByName:function(d,b){var f,a,e;for(f=0,a=this.children.length;f<a;f++){e=this.children[f];if(e.name===d){return e}if(b){e=e.getChildByName(d,b);if(e!==undefined){return e}}}return undefined},updateMatrix:function(){this.matrix.setPosition(this.position);if(this.useQuaternion){this.matrix.setRotationFromQuaternion(this.quaternion)}else{this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder)}if(this.scale.x!==1||this.scale.y!==1||this.scale.z!==1){this.matrix.scale(this.scale);this.boundRadiusScale=Math.max(this.scale.x,Math.max(this.scale.y,this.scale.z))}this.matrixWorldNeedsUpdate=true},updateMatrixWorld:function(c){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||c){if(this.parent){this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix)}else{this.matrixWorld.copy(this.matrix)}this.matrixWorldNeedsUpdate=false;c=true}for(var b=0,a=this.children.length;b<a;b++){this.children[b].updateMatrixWorld(c)}}};THREE.Object3DCount=0;THREE.Projector=function(){var o,c,l=[],i,m,q=[],a,k,w=[],p,j=[],d,b,u=[],H,t,x=[],G={objects:[],sprites:[],lights:[],elements:[]},h=new THREE.Vector3(),f=new THREE.Vector4(),g=new THREE.Matrix4(),A=new THREE.Matrix4(),C=new THREE.Frustum(),E=new THREE.Vector4(),F=new THREE.Vector4(),y;this.projectVector=function(I,J){J.matrixWorldInverse.getInverse(J.matrixWorld);g.multiply(J.projectionMatrix,J.matrixWorldInverse);g.multiplyVector3(I);return I};this.unprojectVector=function(I,J){J.projectionMatrixInverse.getInverse(J.projectionMatrix);g.multiply(J.matrixWorld,J.projectionMatrixInverse);g.multiplyVector3(I);return I};this.pickingRay=function(K,M){var J,I,L;K.z=-1;J=new THREE.Vector3(K.x,K.y,1);this.unprojectVector(K,M);this.unprojectVector(J,M);J.subSelf(K).normalize();return new THREE.Ray(K,J)};this.projectGraph=function(I,J){c=0;G.objects.length=0;G.sprites.length=0;G.lights.length=0;var K=function(M){if(M.visible===false){return}if((M instanceof THREE.Mesh||M instanceof THREE.Line)&&(M.frustumCulled===false||C.contains(M))){h.copy(M.matrixWorld.getPosition());g.multiplyVector3(h);o=s();o.object=M;o.z=h.z;G.objects.push(o)}else{if(M instanceof THREE.Sprite||M instanceof THREE.Particle){h.copy(M.matrixWorld.getPosition());g.multiplyVector3(h);o=s();o.object=M;o.z=h.z;G.sprites.push(o)}else{if(M instanceof THREE.Light){G.lights.push(M)}}}for(var N=0,L=M.children.length;N<L;N++){K(M.children[N])}};K(I);J&&G.objects.sort(r);return G};this.projectScene=function(T,P,am){var W=P.near,N=P.far,S=false,ai,Z,af,O,al,V,aj,aq,ao,U,ag,ab,ae,Y,aa,M,ak,I,Q,R,L,K,J,ah,ac,ad,at,ar,ap,an;k=0;p=0;b=0;t=0;G.elements.length=0;if(P.parent===undefined){console.warn("DEPRECATED: Camera hasn't been added to a Scene. Adding it...");T.add(P)}T.updateMatrixWorld();P.matrixWorldInverse.getInverse(P.matrixWorld);g.multiply(P.projectionMatrix,P.matrixWorldInverse);C.setFromMatrix(g);G=this.projectGraph(T,false);for(ai=0,Z=G.objects.length;ai<Z;ai++){ae=G.objects[ai].object;Y=ae.matrixWorld;m=0;if(ae instanceof THREE.Mesh){M=ae.geometry;ak=ae.geometry.materials;I=M.vertices;L=M.faces;ac=M.faceVertexUvs;aa=ae.matrixRotationWorld.extractRotation(Y);for(af=0,O=I.length;af<O;af++){i=n();i.positionWorld.copy(I[af]);Y.multiplyVector3(i.positionWorld);i.positionScreen.copy(i.positionWorld);g.multiplyVector4(i.positionScreen);i.positionScreen.x/=i.positionScreen.w;i.positionScreen.y/=i.positionScreen.w;i.visible=i.positionScreen.z>W&&i.positionScreen.z<N}for(al=0,V=L.length;al<V;al++){K=L[al];if(K instanceof THREE.Face3){at=q[K.a];ar=q[K.b];ap=q[K.c];if(at.visible&&ar.visible&&ap.visible){S=((ap.positionScreen.x-at.positionScreen.x)*(ar.positionScreen.y-at.positionScreen.y)-(ap.positionScreen.y-at.positionScreen.y)*(ar.positionScreen.x-at.positionScreen.x))<0;if(ae.doubleSided||S!=ae.flipSided){a=B();a.v1.copy(at);a.v2.copy(ar);a.v3.copy(ap)}else{continue}}else{continue}}else{if(K instanceof THREE.Face4){at=q[K.a];ar=q[K.b];ap=q[K.c];an=q[K.d];if(at.visible&&ar.visible&&ap.visible&&an.visible){S=(an.positionScreen.x-at.positionScreen.x)*(ar.positionScreen.y-at.positionScreen.y)-(an.positionScreen.y-at.positionScreen.y)*(ar.positionScreen.x-at.positionScreen.x)<0||(ar.positionScreen.x-ap.positionScreen.x)*(an.positionScreen.y-ap.positionScreen.y)-(ar.positionScreen.y-ap.positionScreen.y)*(an.positionScreen.x-ap.positionScreen.x)<0;if(ae.doubleSided||S!=ae.flipSided){a=z();a.v1.copy(at);a.v2.copy(ar);a.v3.copy(ap);a.v4.copy(an)}else{continue}}else{continue}}}a.normalWorld.copy(K.normal);if(!S&&(ae.flipSided||ae.doubleSided)){a.normalWorld.negate()}aa.multiplyVector3(a.normalWorld);a.centroidWorld.copy(K.centroid);Y.multiplyVector3(a.centroidWorld);a.centroidScreen.copy(a.centroidWorld);g.multiplyVector3(a.centroidScreen);J=K.vertexNormals;for(aj=0,aq=J.length;aj<aq;aj++){ah=a.vertexNormalsWorld[aj];ah.copy(J[aj]);if(!S&&(ae.flipSided||ae.doubleSided)){ah.negate()}aa.multiplyVector3(ah)}for(ao=0,U=ac.length;ao<U;ao++){ad=ac[ao][al];if(!ad){continue}for(ag=0,ab=ad.length;ag<ab;ag++){a.uvs[ao][ag]=ad[ag]}}a.material=ae.material;a.faceMaterial=K.materialIndex!==null?ak[K.materialIndex]:null;a.z=a.centroidScreen.z;G.elements.push(a)}}else{if(ae instanceof THREE.Line){A.multiply(g,Y);I=ae.geometry.vertices;at=n();at.positionScreen.copy(I[0]);A.multiplyVector4(at.positionScreen);var X=ae.type===THREE.LinePieces?2:1;for(af=1,O=I.length;af<O;af++){at=n();at.positionScreen.copy(I[af]);A.multiplyVector4(at.positionScreen);if((af+1)%X>0){continue}ar=q[m-2];E.copy(at.positionScreen);F.copy(ar.positionScreen);if(e(E,F)){E.multiplyScalar(1/E.w);F.multiplyScalar(1/F.w);d=D();d.v1.positionScreen.copy(E);d.v2.positionScreen.copy(F);d.z=Math.max(E.z,F.z);d.material=ae.material;G.elements.push(d)}}}}}for(ai=0,Z=G.sprites.length;ai<Z;ai++){ae=G.sprites[ai].object;Y=ae.matrixWorld;if(ae instanceof THREE.Particle){f.set(Y.elements[12],Y.elements[13],Y.elements[14],1);g.multiplyVector4(f);f.z/=f.w;if(f.z>0&&f.z<1){H=v();H.x=f.x/f.w;H.y=f.y/f.w;H.z=f.z;H.rotation=ae.rotation.z;H.scale.x=ae.scale.x*Math.abs(H.x-(f.x+P.projectionMatrix.elements[0])/(f.w+P.projectionMatrix.elements[12]));H.scale.y=ae.scale.y*Math.abs(H.y-(f.y+P.projectionMatrix.elements[5])/(f.w+P.projectionMatrix.elements[13]));H.material=ae.material;G.elements.push(H)}}}am&&G.elements.sort(r);return G};function s(){var I=l[c]=l[c]||new THREE.RenderableObject();c++;return I}function n(){var I=q[m]=q[m]||new THREE.RenderableVertex();m++;return I}function B(){var I=w[k]=w[k]||new THREE.RenderableFace3();k++;return I}function z(){var I=j[p]=j[p]||new THREE.RenderableFace4();p++;return I}function D(){var I=u[b]=u[b]||new THREE.RenderableLine();b++;return I}function v(){var I=x[t]=x[t]||new THREE.RenderableParticle();t++;return I}function r(J,I){return I.z-J.z}function e(M,L){var K=0,P=1,N=M.z+M.w,J=L.z+L.w,I=-M.z+M.w,O=-L.z+L.w;if(N>=0&&J>=0&&I>=0&&O>=0){return true}else{if((N<0&&J<0)||(I<0&&O<0)){return false}else{if(N<0){K=Math.max(K,N/(N-J))}else{if(J<0){P=Math.min(P,N/(N-J))}}if(I<0){K=Math.max(K,I/(I-O))}else{if(O<0){P=Math.min(P,I/(I-O))}}if(P<K){return false}else{M.lerpSelf(L,K);L.lerpSelf(M,1-P);return true}}}}};THREE.Quaternion=function(a,d,c,b){this.x=a||0;this.y=d||0;this.z=c||0;this.w=(b!==undefined)?b:1};THREE.Quaternion.prototype={constructor:THREE.Quaternion,set:function(a,d,c,b){this.x=a;this.y=d;this.z=c;this.w=b;return this},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w;return this},setFromEuler:function(b){var h=Math.PI/360,l=b.x*h,j=b.y*h,i=b.z*h,f=Math.cos(j),n=Math.sin(j),e=Math.cos(-i),m=Math.sin(-i),d=Math.cos(l),k=Math.sin(l),a=f*e,g=n*m;this.w=a*d-g*k;this.x=a*k+g*d;this.y=n*e*d+f*m*k;this.z=f*m*d-n*e*k;return this},setFromAxisAngle:function(c,d){var a=d/2,b=Math.sin(a);this.x=c.x*b;this.y=c.y*b;this.z=c.z*b;this.w=Math.cos(a);return this},setFromRotationMatrix:function(a){function c(e,d){return d<0?-Math.abs(e):Math.abs(e)}var b=Math.pow(a.determinant(),1/3);this.w=Math.sqrt(Math.max(0,b+a.elements[0]+a.elements[5]+a.elements[10]))/2;this.x=Math.sqrt(Math.max(0,b+a.elements[0]-a.elements[5]-a.elements[10]))/2;this.y=Math.sqrt(Math.max(0,b-a.elements[0]+a.elements[5]-a.elements[10]))/2;this.z=Math.sqrt(Math.max(0,b-a.elements[0]-a.elements[5]+a.elements[10]))/2;this.x=c(this.x,(a.elements[6]-a.elements[9]));this.y=c(this.y,(a.elements[8]-a.elements[2]));this.z=c(this.z,(a.elements[1]-a.elements[4]));this.normalize();return this},calculateW:function(){this.w=-Math.sqrt(Math.abs(1-this.x*this.x-this.y*this.y-this.z*this.z));return this},inverse:function(){this.x*=-1;this.y*=-1;this.z*=-1;return this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);if(a===0){this.x=0;this.y=0;this.z=0;this.w=0}else{a=1/a;this.x=this.x*a;this.y=this.y*a;this.z=this.z*a;this.w=this.w*a}return this},multiply:function(d,c){this.x=d.x*c.w+d.y*c.z-d.z*c.y+d.w*c.x;this.y=-d.x*c.z+d.y*c.w+d.z*c.x+d.w*c.y;this.z=d.x*c.y-d.y*c.x+d.z*c.w+d.w*c.z;this.w=-d.x*c.x-d.y*c.y-d.z*c.z+d.w*c.w;return this},multiplySelf:function(j){var h=this.x,g=this.y,f=this.z,i=this.w,d=j.x,c=j.y,a=j.z,e=j.w;this.x=h*e+i*d+g*a-f*c;this.y=g*e+i*c+f*d-h*a;this.z=f*e+i*a+h*c-g*d;this.w=i*e-h*d-g*c-f*a;return this},multiplyVector3:function(c,m){if(!m){m=c}var l=c.x,k=c.y,j=c.z,h=this.x,g=this.y,f=this.z,i=this.w;var d=i*l+g*j-f*k,b=i*k+f*l-h*j,a=i*j+h*k-g*l,e=-h*l-g*k-f*j;m.x=d*i+e*-h+b*-f-a*-g;m.y=b*i+e*-g+a*-h-d*-f;m.z=a*i+e*-f+d*-g-b*-h;return m},clone:function(){return new THREE.Quaternion(this.x,this.y,this.z,this.w)}};THREE.Quaternion.slerp=function(e,c,h,i){var b=e.w*c.w+e.x*c.x+e.y*c.y+e.z*c.z;if(b<0){h.w=-c.w;h.x=-c.x;h.y=-c.y;h.z=-c.z;b=-b}else{h.copy(c)}if(Math.abs(b)>=1){h.w=e.w;h.x=e.x;h.y=e.y;h.z=e.z;return h}var d=Math.acos(b),a=Math.sqrt(1-b*b);if(Math.abs(a)<0.001){h.w=0.5*(e.w+c.w);h.x=0.5*(e.x+c.x);h.y=0.5*(e.y+c.y);h.z=0.5*(e.z+c.z);return h}var g=Math.sin((1-i)*d)/a,f=Math.sin(i*d)/a;h.w=(e.w*g+h.w*f);h.x=(e.x*g+h.x*f);h.y=(e.y*g+h.y*f);h.z=(e.z*g+h.z*f);return h};THREE.Vertex=function(){console.warn("THREE.Vertex has been DEPRECATED. Use THREE.Vector3 instead.")};THREE.Face3=function(f,e,i,h,g,d){this.a=f;this.b=e;this.c=i;this.normal=h instanceof THREE.Vector3?h:new THREE.Vector3();this.vertexNormals=h instanceof Array?h:[];this.color=g instanceof THREE.Color?g:new THREE.Color();this.vertexColors=g instanceof Array?g:[];this.vertexTangents=[];this.materialIndex=d;this.centroid=new THREE.Vector3()};THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){var c=new THREE.Face3(this.a,this.b,this.c);c.normal.copy(this.normal);c.color.copy(this.color);c.centroid.copy(this.centroid);c.materialIndex=this.materialIndex;var b,a;for(b=0,a=this.vertexNormals.length;b<a;b++){c.vertexNormals[b]=this.vertexNormals[b].clone()}for(b=0,a=this.vertexColors.length;b<a;b++){c.vertexColors[b]=this.vertexColors[b].clone()}for(b=0,a=this.vertexTangents.length;b<a;b++){c.vertexTangents[b]=this.vertexTangents[b].clone()}return c}};THREE.Face4=function(g,f,k,j,i,h,e){this.a=g;this.b=f;this.c=k;this.d=j;this.normal=i instanceof THREE.Vector3?i:new THREE.Vector3();this.vertexNormals=i instanceof Array?i:[];this.color=h instanceof THREE.Color?h:new THREE.Color();this.vertexColors=h instanceof Array?h:[];this.vertexTangents=[];this.materialIndex=e;this.centroid=new THREE.Vector3()};THREE.Face4.prototype={constructor:THREE.Face4,clone:function(){var c=new THREE.Face4(this.a,this.b,this.c,this.d);c.normal.copy(this.normal);c.color.copy(this.color);c.centroid.copy(this.centroid);c.materialIndex=this.materialIndex;var b,a;for(b=0,a=this.vertexNormals.length;b<a;b++){c.vertexNormals[b]=this.vertexNormals[b].clone()}for(b=0,a=this.vertexColors.length;b<a;b++){c.vertexColors[b]=this.vertexColors[b].clone()}for(b=0,a=this.vertexTangents.length;b<a;b++){c.vertexTangents[b]=this.vertexTangents[b].clone()}return c}};THREE.UV=function(b,a){this.u=b||0;this.v=a||0};THREE.UV.prototype={constructor:THREE.UV,set:function(b,a){this.u=b;this.v=a;return this},copy:function(a){this.u=a.u;this.v=a.v;return this},lerpSelf:function(a,b){this.u+=(a.u-this.u)*b;this.v+=(a.v-this.v)*b;return this},clone:function(){return new THREE.UV(this.u,this.v)}};THREE.Geometry=function(){this.id=THREE.GeometryCount++;this.vertices=[];this.colors=[];this.materials=[];this.faces=[];this.faceUvs=[[]];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.boundingBox=null;this.boundingSphere=null;this.hasTangents=false;this.dynamic=false};THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(b){var f=new THREE.Matrix4();f.extractRotation(b);for(var e=0,a=this.vertices.length;e<a;e++){var h=this.vertices[e];b.multiplyVector3(h)}for(var e=0,a=this.faces.length;e<a;e++){var g=this.faces[e];f.multiplyVector3(g.normal);for(var c=0,d=g.vertexNormals.length;c<d;c++){f.multiplyVector3(g.vertexNormals[c])}b.multiplyVector3(g.centroid)}},computeCentroids:function(){var c,b,a;for(c=0,b=this.faces.length;c<b;c++){a=this.faces[c];a.centroid.set(0,0,0);if(a instanceof THREE.Face3){a.centroid.addSelf(this.vertices[a.a]);a.centroid.addSelf(this.vertices[a.b]);a.centroid.addSelf(this.vertices[a.c]);a.centroid.divideScalar(3)}else{if(a instanceof THREE.Face4){a.centroid.addSelf(this.vertices[a.a]);a.centroid.addSelf(this.vertices[a.b]);a.centroid.addSelf(this.vertices[a.c]);a.centroid.addSelf(this.vertices[a.d]);a.centroid.divideScalar(4)}}}},computeFaceNormals:function(){var e,b,m,g,i,j,l,k,d,c,a,h=new THREE.Vector3(),o=new THREE.Vector3();for(j=0,l=this.faces.length;j<l;j++){k=this.faces[j];d=this.vertices[k.a];c=this.vertices[k.b];a=this.vertices[k.c];h.sub(a,c);o.sub(d,c);h.crossSelf(o);if(!h.isZero()){h.normalize()}k.normal.copy(h)}},computeVertexNormals:function(){var a,c,g,e,d,b;if(this.__tmpVertices===undefined){this.__tmpVertices=new Array(this.vertices.length);b=this.__tmpVertices;for(a=0,c=this.vertices.length;a<c;a++){b[a]=new THREE.Vector3()}for(g=0,e=this.faces.length;g<e;g++){d=this.faces[g];if(d instanceof THREE.Face3){d.vertexNormals=[new THREE.Vector3(),new THREE.Vector3(),new THREE.Vector3()]}else{if(d instanceof THREE.Face4){d.vertexNormals=[new THREE.Vector3(),new THREE.Vector3(),new THREE.Vector3(),new THREE.Vector3()]}}}}else{b=this.__tmpVertices;for(a=0,c=this.vertices.length;a<c;a++){b[a].set(0,0,0)}}for(g=0,e=this.faces.length;g<e;g++){d=this.faces[g];if(d instanceof THREE.Face3){b[d.a].addSelf(d.normal);b[d.b].addSelf(d.normal);b[d.c].addSelf(d.normal)}else{if(d instanceof THREE.Face4){b[d.a].addSelf(d.normal);b[d.b].addSelf(d.normal);b[d.c].addSelf(d.normal);b[d.d].addSelf(d.normal)}}}for(a=0,c=this.vertices.length;a<c;a++){b[a].normalize()}for(g=0,e=this.faces.length;g<e;g++){d=this.faces[g];if(d instanceof THREE.Face3){d.vertexNormals[0].copy(b[d.a]);d.vertexNormals[1].copy(b[d.b]);d.vertexNormals[2].copy(b[d.c])}else{if(d instanceof THREE.Face4){d.vertexNormals[0].copy(b[d.a]);d.vertexNormals[1].copy(b[d.b]);d.vertexNormals[2].copy(b[d.c]);d.vertexNormals[3].copy(b[d.d])}}}},computeMorphNormals:function(){var e,l,g,m,h;for(g=0,m=this.faces.length;g<m;g++){h=this.faces[g];if(!h.__originalFaceNormal){h.__originalFaceNormal=h.normal.clone()}else{h.__originalFaceNormal.copy(h.normal)}if(!h.__originalVertexNormals){h.__originalVertexNormals=[]}for(e=0,l=h.vertexNormals.length;e<l;e++){if(!h.__originalVertexNormals[e]){h.__originalVertexNormals[e]=h.vertexNormals[e].clone()}else{h.__originalVertexNormals[e].copy(h.vertexNormals[e])}}}var c=new THREE.Geometry();c.faces=this.faces;for(e=0,l=this.morphTargets.length;e<l;e++){if(!this.morphNormals[e]){this.morphNormals[e]={};this.morphNormals[e].faceNormals=[];this.morphNormals[e].vertexNormals=[];var d=this.morphNormals[e].faceNormals;var a=this.morphNormals[e].vertexNormals;var k,b;for(g=0,m=this.faces.length;g<m;g++){h=this.faces[g];k=new THREE.Vector3();if(h instanceof THREE.Face3){b={a:new THREE.Vector3(),b:new THREE.Vector3(),c:new THREE.Vector3()}}else{b={a:new THREE.Vector3(),b:new THREE.Vector3(),c:new THREE.Vector3(),d:new THREE.Vector3()}}d.push(k);a.push(b)}}var j=this.morphNormals[e];c.vertices=this.morphTargets[e].vertices;c.computeFaceNormals();c.computeVertexNormals();var k,b;for(g=0,m=this.faces.length;g<m;g++){h=this.faces[g];k=j.faceNormals[g];b=j.vertexNormals[g];k.copy(h.normal);if(h instanceof THREE.Face3){b.a.copy(h.vertexNormals[0]);b.b.copy(h.vertexNormals[1]);b.c.copy(h.vertexNormals[2])}else{b.a.copy(h.vertexNormals[0]);b.b.copy(h.vertexNormals[1]);b.c.copy(h.vertexNormals[2]);b.d.copy(h.vertexNormals[3])}}}for(g=0,m=this.faces.length;g<m;g++){h=this.faces[g];h.normal=h.__originalFaceNormal;h.vertexNormals=h.__originalVertexNormals}},computeTangents:function(){var L,m,B,k,K,p,z,g,o,H,E,D,e,d,c,j,h,S,R,x,u,O,N,s,q,F,C,b,Q=[],P=[],a=new THREE.Vector3(),l=new THREE.Vector3(),I=new THREE.Vector3(),M=new THREE.Vector3(),J=new THREE.Vector3(),A;for(B=0,k=this.vertices.length;B<k;B++){Q[B]=new THREE.Vector3();P[B]=new THREE.Vector3()}function y(v,i,f,w,t,r,n){H=v.vertices[i];E=v.vertices[f];D=v.vertices[w];e=o[t];d=o[r];c=o[n];j=E.x-H.x;h=D.x-H.x;S=E.y-H.y;R=D.y-H.y;x=E.z-H.z;u=D.z-H.z;O=d.u-e.u;N=c.u-e.u;s=d.v-e.v;q=c.v-e.v;F=1/(O*q-N*s);a.set((q*j-s*h)*F,(q*S-s*R)*F,(q*x-s*u)*F);l.set((O*h-N*j)*F,(O*R-N*S)*F,(O*u-N*x)*F);Q[i].addSelf(a);Q[f].addSelf(a);Q[w].addSelf(a);P[i].addSelf(l);P[f].addSelf(l);P[w].addSelf(l)}for(L=0,m=this.faces.length;L<m;L++){g=this.faces[L];o=this.faceVertexUvs[0][L];if(g instanceof THREE.Face3){y(this,g.a,g.b,g.c,0,1,2)}else{if(g instanceof THREE.Face4){y(this,g.a,g.b,g.d,0,1,3);y(this,g.b,g.c,g.d,1,2,3)}}}var G=["a","b","c","d"];for(L=0,m=this.faces.length;L<m;L++){g=this.faces[L];for(K=0;K<g.vertexNormals.length;K++){J.copy(g.vertexNormals[K]);z=g[G[K]];C=Q[z];I.copy(C);I.subSelf(J.multiplyScalar(J.dot(C))).normalize();M.cross(g.vertexNormals[K],C);b=M.dot(P[z]);A=(b<0)?-1:1;g.vertexTangents[K]=new THREE.Vector4(I.x,I.y,I.z,A)}}this.hasTangents=true},computeBoundingBox:function(){if(!this.boundingBox){this.boundingBox={min:new THREE.Vector3(),max:new THREE.Vector3()}}if(this.vertices.length>0){var b,f=this.vertices[0];this.boundingBox.min.copy(f);this.boundingBox.max.copy(f);var d=this.boundingBox.min,a=this.boundingBox.max;for(var c=1,e=this.vertices.length;c<e;c++){b=this.vertices[c];if(b.x<d.x){d.x=b.x}else{if(b.x>a.x){a.x=b.x}}if(b.y<d.y){d.y=b.y}else{if(b.y>a.y){a.y=b.y}}if(b.z<d.z){d.z=b.z}else{if(b.z>a.z){a.z=b.z}}}}else{this.boundingBox.min.set(0,0,0);this.boundingBox.max.set(0,0,0)}},computeBoundingSphere:function(){if(!this.boundingSphere){this.boundingSphere={radius:0}}var a,d=0;for(var b=0,c=this.vertices.length;b<c;b++){a=this.vertices[b].length();if(a>d){d=a}}this.boundingSphere.radius=d},mergeVertices:function(){var n={};var e=[],q=[];var t,s;var g=4;var l=Math.pow(10,g);var h,p,m;var b="abcd",a,c,d,f,w;for(h=0,p=this.vertices.length;h<p;h++){t=this.vertices[h];s=[Math.round(t.x*l),Math.round(t.y*l),Math.round(t.z*l)].join("_");if(n[s]===undefined){n[s]=h;e.push(this.vertices[h]);q[h]=e.length-1}else{q[h]=q[n[s]]}}for(h=0,p=this.faces.length;h<p;h++){m=this.faces[h];if(m instanceof THREE.Face3){m.a=q[m.a];m.b=q[m.b];m.c=q[m.c]}else{if(m instanceof THREE.Face4){m.a=q[m.a];m.b=q[m.b];m.c=q[m.c];m.d=q[m.d];a=[m.a,m.b,m.c,m.d];for(c=3;c>0;c--){if(a.indexOf(m[b[c]])!=c){a.splice(c,1);this.faces[h]=new THREE.Face3(a[0],a[1],a[2]);for(d=0,f=this.faceVertexUvs.length;d<f;d++){w=this.faceVertexUvs[d][h];if(w){w.splice(c,1)}}break}}}}}var r=this.vertices.length-e.length;this.vertices=e;return r}};THREE.GeometryCount=0;THREE.Spline=function(n){this.points=n;var h=[],j={x:0,y:0,z:0},m,a,e,d,b,l,k,i,g;this.initFromArray=function(c){this.points=[];for(var o=0;o<c.length;o++){this.points[o]={x:c[o][0],y:c[o][1],z:c[o][2]}}};this.getPoint=function(c){m=(this.points.length-1)*c;a=Math.floor(m);e=m-a;h[0]=a===0?a:a-1;h[1]=a;h[2]=a>this.points.length-2?this.points.length-1:a+1;h[3]=a>this.points.length-3?this.points.length-1:a+2;l=this.points[h[0]];k=this.points[h[1]];i=this.points[h[2]];g=this.points[h[3]];d=e*e;b=e*d;j.x=f(l.x,k.x,i.x,g.x,e,d,b);j.y=f(l.y,k.y,i.y,g.y,e,d,b);j.z=f(l.z,k.z,i.z,g.z,e,d,b);return j};this.getControlPointsArray=function(){var o,r,c=this.points.length,q=[];for(o=0;o<c;o++){r=this.points[o];q[o]=[r.x,r.y,r.z]}return q};this.getLength=function(p){var r,t,u,s,x=0,c=0,q=0,w=new THREE.Vector3(),o=new THREE.Vector3(),v=[],y=0;v[0]=0;if(!p){p=100}u=this.points.length*p;w.copy(this.points[0]);for(r=1;r<u;r++){t=r/u;s=this.getPoint(t);o.copy(s);y+=o.distanceTo(w);w.copy(s);x=(this.points.length-1)*t;c=Math.floor(x);if(c!=q){v[c]=y;q=c}}v[v.length]=y;return{chunks:v,total:y}};this.reparametrizeByArcLength=function(p){var t,s,w,x,q,o,y,v,u,z=[],c=new THREE.Vector3(),r=this.getLength();z.push(c.copy(this.points[0]).clone());for(t=1;t<this.points.length;t++){y=r.chunks[t]-r.chunks[t-1];v=Math.ceil(p*y/r.total);x=(t-1)/(this.points.length-1);q=t/(this.points.length-1);for(s=1;s<v-1;s++){w=x+s*(1/v)*(q-x);u=this.getPoint(w);z.push(c.copy(u).clone())}z.push(c.copy(this.points[t]).clone())}this.points=z};function f(v,u,r,q,w,o,c){var s=(r-v)*0.5,p=(q-u)*0.5;return(2*(u-r)+s+p)*c+(-3*(u-r)-2*s-p)*o+s*w+u}};THREE.Camera=function(){THREE.Object3D.call(this);this.matrixWorldInverse=new THREE.Matrix4();this.projectionMatrix=new THREE.Matrix4();this.projectionMatrixInverse=new THREE.Matrix4()};THREE.Camera.prototype=new THREE.Object3D();THREE.Camera.prototype.constructor=THREE.Camera;THREE.Camera.prototype.lookAt=function(a){this.matrix.lookAt(this.position,a,this.up);if(this.rotationAutoUpdate){this.rotation.getRotationFromMatrix(this.matrix)}};THREE.Loader=function(a){this.showStatus=a;this.statusDomElement=a?THREE.Loader.prototype.addStatusElement():null;this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};THREE.Loader.prototype={constructor:THREE.Loader,crossOrigin:"anonymous",addStatusElement:function(){var a=document.createElement("div");a.style.position="absolute";a.style.right="0px";a.style.top="0px";a.style.fontSize="0.8em";a.style.textAlign="left";a.style.background="rgba(0,0,0,0.25)";a.style.color="#fff";a.style.width="120px";a.style.padding="0.5em 0.5em 0.5em 0.5em";a.style.zIndex=1000;a.innerHTML="Loading ...";return a},updateProgress:function(a){var b="Loaded ";if(a.total){b+=(100*a.loaded/a.total).toFixed(0)+"%"}else{b+=(a.loaded/1000).toFixed(2)+" KB"}this.statusDomElement.innerHTML=b},extractUrlBase:function(a){var b=a.split("/");b.pop();return(b.length<1?".":b.join("/"))+"/"},initMaterials:function(c,a,d){c.materials=[];for(var b=0;b<a.length;++b){c.materials[b]=THREE.Loader.prototype.createMaterial(a[b],d)}},hasNormals:function(d){var a,c,b=d.materials.length;for(c=0;c<b;c++){a=d.materials[c];if(a instanceof THREE.ShaderMaterial){return true}}return false},createMaterial:function(f,c){var h=this;function e(q){var m=Math.log(q)/Math.LN2;return Math.floor(m)==m}function a(q){var m=Math.log(q)/Math.LN2;return Math.pow(2,Math.round(m))}function n(q,m){var r=new Image();r.onload=function(){if(!e(this.width)||!e(this.height)){var t=a(this.width);var s=a(this.height);q.image.width=t;q.image.height=s;q.image.getContext("2d").drawImage(this,0,0,t,s)}else{q.image=this}q.needsUpdate=true};r.crossOrigin=h.crossOrigin;r.src=m}function j(s,r,q,v,w,t){var u=document.createElement("canvas");s[r]=new THREE.Texture(u);s[r].sourceFile=q;if(v){s[r].repeat.set(v[0],v[1]);if(v[0]!=1){s[r].wrapS=THREE.RepeatWrapping}if(v[1]!=1){s[r].wrapT=THREE.RepeatWrapping}}if(w){s[r].offset.set(w[0],w[1])}if(t){var m={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping};if(m[t[0]]!==undefined){s[r].wrapS=m[t[0]]}if(m[t[1]]!==undefined){s[r].wrapT=m[t[1]]}}n(s[r],c+"/"+q)}function b(m){return(m[0]*255<<16)+(m[1]*255<<8)+m[2]*255}var d="MeshLambertMaterial";var l={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,wireframe:f.wireframe};if(f.shading){var k=f.shading.toLowerCase();if(k==="phong"){d="MeshPhongMaterial"}else{if(k==="basic"){d="MeshBasicMaterial"}}}if(f.blending!==undefined&&THREE[f.blending]!==undefined){l.blending=THREE[f.blending]}if(f.transparent!==undefined||f.opacity<1){l.transparent=f.transparent}if(f.depthTest!==undefined){l.depthTest=f.depthTest}if(f.depthWrite!==undefined){l.depthWrite=f.depthWrite}if(f.vertexColors!==undefined){if(f.vertexColors=="face"){l.vertexColors=THREE.FaceColors}else{if(f.vertexColors){l.vertexColors=THREE.VertexColors}}}if(f.colorDiffuse){l.color=b(f.colorDiffuse)}else{if(f.DbgColor){l.color=f.DbgColor}}if(f.colorSpecular){l.specular=b(f.colorSpecular)}if(f.colorAmbient){l.ambient=b(f.colorAmbient)}if(f.transparency){l.opacity=f.transparency}if(f.specularCoef){l.shininess=f.specularCoef}if(f.mapDiffuse&&c){j(l,"map",f.mapDiffuse,f.mapDiffuseRepeat,f.mapDiffuseOffset,f.mapDiffuseWrap)}if(f.mapLight&&c){j(l,"lightMap",f.mapLight,f.mapLightRepeat,f.mapLightOffset,f.mapLightWrap)}if(f.mapNormal&&c){j(l,"normalMap",f.mapNormal,f.mapNormalRepeat,f.mapNormalOffset,f.mapNormalWrap)}if(f.mapSpecular&&c){j(l,"specularMap",f.mapSpecular,f.mapSpecularRepeat,f.mapSpecularOffset,f.mapSpecularWrap)}if(f.mapNormal){var g=THREE.ShaderUtils.lib.normal;var o=THREE.UniformsUtils.clone(g.uniforms);o.tNormal.texture=l.normalMap;if(f.mapNormalFactor){o.uNormalScale.value=f.mapNormalFactor}if(l.map){o.tDiffuse.texture=l.map;o.enableDiffuse.value=true}if(l.specularMap){o.tSpecular.texture=l.specularMap;o.enableSpecular.value=true}if(l.lightMap){o.tAO.texture=l.lightMap;o.enableAO.value=true}o.uDiffuseColor.value.setHex(l.color);o.uSpecularColor.value.setHex(l.specular);o.uAmbientColor.value.setHex(l.ambient);o.uShininess.value=l.shininess;if(l.opacity!==undefined){o.uOpacity.value=l.opacity}var p={fragmentShader:g.fragmentShader,vertexShader:g.vertexShader,uniforms:o,lights:true,fog:true};var i=new THREE.ShaderMaterial(p)}else{var i=new THREE[d](l)}if(f.DbgName!==undefined){i.name=f.DbgName}return i}};THREE.JSONLoader=function(a){THREE.Loader.call(this,a)};THREE.JSONLoader.prototype=new THREE.Loader();THREE.JSONLoader.prototype.constructor=THREE.JSONLoader;THREE.JSONLoader.prototype.load=function(a,e,c){var d,b=this;c=c?c:this.extractUrlBase(a);this.onLoadStart();this.loadAjaxJSON(this,a,e,c)};THREE.JSONLoader.prototype.loadAjaxJSON=function(b,a,g,e,d){var f=new XMLHttpRequest();var c=0;f.onreadystatechange=function(){if(f.readyState===f.DONE){if(f.status===200||f.status===0){if(f.responseText){var h=JSON.parse(f.responseText);b.createModel(h,g,e)}else{console.warn("THREE.JSONLoader: ["+a+"] seems to be unreachable or file there is empty")}b.onLoadComplete()}else{console.error("THREE.JSONLoader: Couldn't load ["+a+"] ["+f.status+"]")}}else{if(f.readyState===f.LOADING){if(d){if(c===0){c=f.getResponseHeader("Content-Length")}d({total:c,loaded:f.responseText.length})}}else{if(f.readyState===f.HEADERS_RECEIVED){c=f.getResponseHeader("Content-Length")}}}};f.open("GET",a,true);if(f.overrideMimeType){f.overrideMimeType("text/plain; charset=x-user-defined")}f.setRequestHeader("Content-Type","text/plain");f.send(null)};THREE.JSONLoader.prototype.createModel=function(i,g,c){var h=this,e=new THREE.Geometry(),d=(i.scale!==undefined)?1/i.scale:1;this.initMaterials(e,i.materials,c);b(d);f();a(d);e.computeCentroids();e.computeFaceNormals();if(this.hasNormals(e)){e.computeTangents()}function b(S){function s(u,j){return u&(1<<j)}var M,L,A,q,p,K,o,P,D,t,m,B,E,Q,k,O,J,H,F,N,w,I,R,n,y,C,z,l=i.faces,r=i.vertices,G=i.normals,x=i.colors,T=0;for(M=0;M<i.uvs.length;M++){if(i.uvs[M].length){T++}}for(M=0;M<T;M++){e.faceUvs[M]=[];e.faceVertexUvs[M]=[]}q=0;p=r.length;while(q<p){N=new THREE.Vector3();N.x=r[q++]*S;N.y=r[q++]*S;N.z=r[q++]*S;e.vertices.push(N)}q=0;p=l.length;while(q<p){m=l[q++];B=s(m,0);E=s(m,1);Q=s(m,2);k=s(m,3);O=s(m,4);J=s(m,5);H=s(m,6);F=s(m,7);if(B){w=new THREE.Face4();w.a=l[q++];w.b=l[q++];w.c=l[q++];w.d=l[q++];K=4}else{w=new THREE.Face3();w.a=l[q++];w.b=l[q++];w.c=l[q++];K=3}if(E){t=l[q++];w.materialIndex=t}A=e.faces.length;if(Q){for(M=0;M<T;M++){n=i.uvs[M];D=l[q++];C=n[D*2];z=n[D*2+1];e.faceUvs[M][A]=new THREE.UV(C,z)}}if(k){for(M=0;M<T;M++){n=i.uvs[M];y=[];for(L=0;L<K;L++){D=l[q++];C=n[D*2];z=n[D*2+1];y[L]=new THREE.UV(C,z)}e.faceVertexUvs[M][A]=y}}if(O){P=l[q++]*3;R=new THREE.Vector3();R.x=G[P++];R.y=G[P++];R.z=G[P];w.normal=R}if(J){for(M=0;M<K;M++){P=l[q++]*3;R=new THREE.Vector3();R.x=G[P++];R.y=G[P++];R.z=G[P];w.vertexNormals.push(R)}}if(H){o=l[q++];I=new THREE.Color(x[o]);w.color=I}if(F){for(M=0;M<K;M++){o=l[q++];I=new THREE.Color(x[o]);w.vertexColors.push(I)}}e.faces.push(w)}}function f(){var k,j,s,p,o,t,r,q,n,m;if(i.skinWeights){for(k=0,j=i.skinWeights.length;k<j;k+=2){s=i.skinWeights[k];p=i.skinWeights[k+1];o=0;t=0;e.skinWeights.push(new THREE.Vector4(s,p,o,t))}}if(i.skinIndices){for(k=0,j=i.skinIndices.length;k<j;k+=2){r=i.skinIndices[k];q=i.skinIndices[k+1];n=0;m=0;e.skinIndices.push(new THREE.Vector4(r,q,n,m))}}e.bones=i.bones;e.animation=i.animation}function a(m){if(i.morphTargets!==undefined){var p,n,w,k,r,x;for(p=0,n=i.morphTargets.length;p<n;p++){e.morphTargets[p]={};e.morphTargets[p].name=i.morphTargets[p].name;e.morphTargets[p].vertices=[];r=e.morphTargets[p].vertices;x=i.morphTargets[p].vertices;for(w=0,k=x.length;w<k;w+=3){var q=new THREE.Vector3();q.x=x[w]*m;q.y=x[w+1]*m;q.z=x[w+2]*m;r.push(q)}}}if(i.morphColors!==undefined){var p,n,s,u,t,j,o;for(p=0,n=i.morphColors.length;p<n;p++){e.morphColors[p]={};e.morphColors[p].name=i.morphColors[p].name;e.morphColors[p].colors=[];t=e.morphColors[p].colors;j=i.morphColors[p].colors;for(s=0,u=j.length;s<u;s+=3){o=new THREE.Color(16755200);o.setRGB(j[s],j[s+1],j[s+2]);t.push(o)}}}}g(e)};THREE.Material=function(a){a=a||{};this.id=THREE.MaterialCount++;this.name="";this.opacity=a.opacity!==undefined?a.opacity:1;this.transparent=a.transparent!==undefined?a.transparent:false;this.blending=a.blending!==undefined?a.blending:THREE.NormalBlending;this.blendSrc=a.blendSrc!==undefined?a.blendSrc:THREE.SrcAlphaFactor;this.blendDst=a.blendDst!==undefined?a.blendDst:THREE.OneMinusSrcAlphaFactor;this.blendEquation=a.blendEquation!==undefined?a.blendEquation:THREE.AddEquation;this.depthTest=a.depthTest!==undefined?a.depthTest:true;this.depthWrite=a.depthWrite!==undefined?a.depthWrite:true;this.polygonOffset=a.polygonOffset!==undefined?a.polygonOffset:false;this.polygonOffsetFactor=a.polygonOffsetFactor!==undefined?a.polygonOffsetFactor:0;this.polygonOffsetUnits=a.polygonOffsetUnits!==undefined?a.polygonOffsetUnits:0;this.alphaTest=a.alphaTest!==undefined?a.alphaTest:0;this.overdraw=a.overdraw!==undefined?a.overdraw:false;this.visible=true;this.needsUpdate=true};THREE.MaterialCount=0;THREE.NoShading=0;THREE.FlatShading=1;THREE.SmoothShading=2;THREE.NoColors=0;THREE.FaceColors=1;THREE.VertexColors=2;THREE.NoBlending=0;THREE.NormalBlending=1;THREE.AdditiveBlending=2;THREE.SubtractiveBlending=3;THREE.MultiplyBlending=4;THREE.AdditiveAlphaBlending=5;THREE.CustomBlending=6;THREE.AddEquation=100;THREE.SubtractEquation=101;THREE.ReverseSubtractEquation=102;THREE.ZeroFactor=200;THREE.OneFactor=201;THREE.SrcColorFactor=202;THREE.OneMinusSrcColorFactor=203;THREE.SrcAlphaFactor=204;THREE.OneMinusSrcAlphaFactor=205;THREE.DstAlphaFactor=206;THREE.OneMinusDstAlphaFactor=207;THREE.DstColorFactor=208;THREE.OneMinusDstColorFactor=209;THREE.SrcAlphaSaturateFactor=210;THREE.LineBasicMaterial=function(a){THREE.Material.call(this,a);a=a||{};this.color=a.color!==undefined?new THREE.Color(a.color):new THREE.Color(16777215);this.linewidth=a.linewidth!==undefined?a.linewidth:1;this.linecap=a.linecap!==undefined?a.linecap:"round";this.linejoin=a.linejoin!==undefined?a.linejoin:"round";this.vertexColors=a.vertexColors?a.vertexColors:false;this.fog=a.fog!==undefined?a.fog:true};THREE.LineBasicMaterial.prototype=new THREE.Material();THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial;THREE.MeshBasicMaterial=function(a){THREE.Material.call(this,a);a=a||{};this.color=a.color!==undefined?new THREE.Color(a.color):new THREE.Color(16777215);this.map=a.map!==undefined?a.map:null;this.lightMap=a.lightMap!==undefined?a.lightMap:null;this.envMap=a.envMap!==undefined?a.envMap:null;this.combine=a.combine!==undefined?a.combine:THREE.MultiplyOperation;this.reflectivity=a.reflectivity!==undefined?a.reflectivity:1;this.refractionRatio=a.refractionRatio!==undefined?a.refractionRatio:0.98;this.fog=a.fog!==undefined?a.fog:true;this.shading=a.shading!==undefined?a.shading:THREE.SmoothShading;this.wireframe=a.wireframe!==undefined?a.wireframe:false;this.wireframeLinewidth=a.wireframeLinewidth!==undefined?a.wireframeLinewidth:1;this.wireframeLinecap=a.wireframeLinecap!==undefined?a.wireframeLinecap:"round";this.wireframeLinejoin=a.wireframeLinejoin!==undefined?a.wireframeLinejoin:"round";this.vertexColors=a.vertexColors!==undefined?a.vertexColors:THREE.NoColors;this.skinning=a.skinning!==undefined?a.skinning:false;this.morphTargets=a.morphTargets!==undefined?a.morphTargets:false};THREE.MeshBasicMaterial.prototype=new THREE.Material();THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial;THREE.MeshLambertMaterial=function(a){THREE.Material.call(this,a);a=a||{};this.color=a.color!==undefined?new THREE.Color(a.color):new THREE.Color(16777215);this.ambient=a.ambient!==undefined?new THREE.Color(a.ambient):new THREE.Color(16777215);this.emissive=a.emissive!==undefined?new THREE.Color(a.emissive):new THREE.Color(0);this.wrapAround=a.wrapAround!==undefined?a.wrapAround:false;this.wrapRGB=new THREE.Vector3(1,1,1);this.map=a.map!==undefined?a.map:null;this.lightMap=a.lightMap!==undefined?a.lightMap:null;this.envMap=a.envMap!==undefined?a.envMap:null;this.combine=a.combine!==undefined?a.combine:THREE.MultiplyOperation;this.reflectivity=a.reflectivity!==undefined?a.reflectivity:1;this.refractionRatio=a.refractionRatio!==undefined?a.refractionRatio:0.98;this.fog=a.fog!==undefined?a.fog:true;this.shading=a.shading!==undefined?a.shading:THREE.SmoothShading;this.wireframe=a.wireframe!==undefined?a.wireframe:false;this.wireframeLinewidth=a.wireframeLinewidth!==undefined?a.wireframeLinewidth:1;this.wireframeLinecap=a.wireframeLinecap!==undefined?a.wireframeLinecap:"round";this.wireframeLinejoin=a.wireframeLinejoin!==undefined?a.wireframeLinejoin:"round";this.vertexColors=a.vertexColors!==undefined?a.vertexColors:THREE.NoColors;this.skinning=a.skinning!==undefined?a.skinning:false;this.morphTargets=a.morphTargets!==undefined?a.morphTargets:false;this.morphNormals=a.morphNormals!==undefined?a.morphNormals:false};THREE.MeshLambertMaterial.prototype=new THREE.Material();THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial;THREE.MeshPhongMaterial=function(a){THREE.Material.call(this,a);a=a||{};this.color=a.color!==undefined?new THREE.Color(a.color):new THREE.Color(16777215);this.ambient=a.ambient!==undefined?new THREE.Color(a.ambient):new THREE.Color(16777215);this.emissive=a.emissive!==undefined?new THREE.Color(a.emissive):new THREE.Color(0);this.specular=a.specular!==undefined?new THREE.Color(a.specular):new THREE.Color(1118481);this.shininess=a.shininess!==undefined?a.shininess:30;this.metal=a.metal!==undefined?a.metal:false;this.perPixel=a.perPixel!==undefined?a.perPixel:false;this.wrapAround=a.wrapAround!==undefined?a.wrapAround:false;this.wrapRGB=new THREE.Vector3(1,1,1);this.map=a.map!==undefined?a.map:null;this.lightMap=a.lightMap!==undefined?a.lightMap:null;this.envMap=a.envMap!==undefined?a.envMap:null;this.combine=a.combine!==undefined?a.combine:THREE.MultiplyOperation;this.reflectivity=a.reflectivity!==undefined?a.reflectivity:1;this.refractionRatio=a.refractionRatio!==undefined?a.refractionRatio:0.98;this.fog=a.fog!==undefined?a.fog:true;this.shading=a.shading!==undefined?a.shading:THREE.SmoothShading;this.wireframe=a.wireframe!==undefined?a.wireframe:false;this.wireframeLinewidth=a.wireframeLinewidth!==undefined?a.wireframeLinewidth:1;this.wireframeLinecap=a.wireframeLinecap!==undefined?a.wireframeLinecap:"round";this.wireframeLinejoin=a.wireframeLinejoin!==undefined?a.wireframeLinejoin:"round";this.vertexColors=a.vertexColors!==undefined?a.vertexColors:THREE.NoColors;this.skinning=a.skinning!==undefined?a.skinning:false;this.morphTargets=a.morphTargets!==undefined?a.morphTargets:false;this.morphNormals=a.morphNormals!==undefined?a.morphNormals:false};THREE.MeshPhongMaterial.prototype=new THREE.Material();THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial;THREE.MeshDepthMaterial=function(a){THREE.Material.call(this,a);a=a||{};this.shading=a.shading!==undefined?a.shading:THREE.SmoothShading;this.wireframe=a.wireframe!==undefined?a.wireframe:false;this.wireframeLinewidth=a.wireframeLinewidth!==undefined?a.wireframeLinewidth:1};THREE.MeshDepthMaterial.prototype=new THREE.Material();THREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial;THREE.MeshNormalMaterial=function(a){THREE.Material.call(this,a);a=a||{};this.shading=a.shading?a.shading:THREE.FlatShading;this.wireframe=a.wireframe?a.wireframe:false;this.wireframeLinewidth=a.wireframeLinewidth?a.wireframeLinewidth:1};THREE.MeshNormalMaterial.prototype=new THREE.Material();THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial;THREE.MeshFaceMaterial=function(){};THREE.ParticleBasicMaterial=function(a){THREE.Material.call(this,a);a=a||{};this.color=a.color!==undefined?new THREE.Color(a.color):new THREE.Color(16777215);this.map=a.map!==undefined?a.map:null;this.size=a.size!==undefined?a.size:1;this.sizeAttenuation=a.sizeAttenuation!==undefined?a.sizeAttenuation:true;this.vertexColors=a.vertexColors!==undefined?a.vertexColors:false;this.fog=a.fog!==undefined?a.fog:true};THREE.ParticleBasicMaterial.prototype=new THREE.Material();THREE.ParticleBasicMaterial.prototype.constructor=THREE.ParticleBasicMaterial;THREE.ParticleCanvasMaterial=function(a){THREE.Material.call(this,a);a=a||{};this.color=a.color!==undefined?new THREE.Color(a.color):new THREE.Color(16777215);this.program=a.program!==undefined?a.program:function(c,b){}};THREE.ParticleCanvasMaterial.prototype=new THREE.Material();THREE.ParticleCanvasMaterial.prototype.constructor=THREE.ParticleCanvasMaterial;THREE.ParticleDOMMaterial=function(a){THREE.Material.call(this);this.domElement=a};THREE.ShaderMaterial=function(a){THREE.Material.call(this,a);a=a||{};this.fragmentShader=a.fragmentShader!==undefined?a.fragmentShader:"void main() {}";this.vertexShader=a.vertexShader!==undefined?a.vertexShader:"void main() {}";this.uniforms=a.uniforms!==undefined?a.uniforms:{};this.attributes=a.attributes;this.shading=a.shading!==undefined?a.shading:THREE.SmoothShading;this.wireframe=a.wireframe!==undefined?a.wireframe:false;this.wireframeLinewidth=a.wireframeLinewidth!==undefined?a.wireframeLinewidth:1;this.fog=a.fog!==undefined?a.fog:false;this.lights=a.lights!==undefined?a.lights:false;this.vertexColors=a.vertexColors!==undefined?a.vertexColors:THREE.NoColors;this.skinning=a.skinning!==undefined?a.skinning:false;this.morphTargets=a.morphTargets!==undefined?a.morphTargets:false;this.morphNormals=a.morphNormals!==undefined?a.morphNormals:false};THREE.ShaderMaterial.prototype=new THREE.Material();THREE.ShaderMaterial.prototype.constructor=THREE.ShaderMaterial;